<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFramework>net6.0</TargetFramework>
        <ServiceProjectDir>../NetworkPerspective.Sync.Office365</ServiceProjectDir>
        <AutoGeneratedClientCs>Office365Client.cs</AutoGeneratedClientCs>
        <AutoGeneratedClientTs>Office365Client.ts</AutoGeneratedClientTs>
        <AutoGeneratedSwagger>swagger.json</AutoGeneratedSwagger>
    </PropertyGroup>

    <ItemGroup>
      <None Remove="dotnet-tools.json" />
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
        <PackageReference Include="NSwag.MSBuild" Version="13.18.2">
            <PrivateAssets>all</PrivateAssets>
            <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
        </PackageReference>
        <PackageReference Include="System.ComponentModel.Annotations" Version="5.0.0" />
    </ItemGroup>

    <ItemGroup>
        <ProjectReference Include="..\NetworkPerspective.Sync.Office365\NetworkPerspective.Sync.Office365.csproj">
            <ReferenceOutputAssembly>False</ReferenceOutputAssembly>
        </ProjectReference>
    </ItemGroup>

    <Target Name="GenerateClients" BeforeTargets="CoreCompile">
        <Exec WorkingDirectory="$(ProjectDir)" Command="dotnet tool restore" ConsoleToMSBuild="true" />
        <Copy SourceFiles="$(ServiceProjectDir)/bin/$(Configuration)/net6.0/NetworkPerspective.Sync.Office365.xml" DestinationFiles="$(ServiceProjectDir)/bin/$(Configuration)/net6.0/dotnet-swagger.xml"></Copy>
        <Exec WorkingDirectory="$(ProjectDir)" Command="dotnet swagger tofile --output $(AutoGeneratedSwagger) $(ServiceProjectDir)/bin/$(Configuration)/net6.0/NetworkPerspective.Sync.Office365.dll v1" ConsoleToMSBuild="true" />
        <Exec WorkingDirectory="$(ProjectDir)" Command="$(NSwagExe_Net60) run /variables:input=$(AutoGeneratedSwagger),outputCs=$(IntermediateOutputPath)\$(AutoGeneratedClientCs),outputTs=$(IntermediateOutputPath)\$(AutoGeneratedClientTs)" ConsoleToMSBuild="true" />
        <ItemGroup>
            <Compile Include="$(IntermediateOutputPath)\$(AutoGeneratedClientCs)" />
        </ItemGroup>
    </Target>

    <Target Name="CleanUpClients" AfterTargets="CoreClean">
        <Delete Files="$(ServiceProjectDir)/bin/$(Configuration)/net6.0/dotnet-swagger.xml"></Delete>
        <Delete Files="$(IntermediateOutputPath)\$(AutoGeneratedClientCs)"></Delete>
        <Delete Files="$(IntermediateOutputPath)\$(AutoGeneratedClientTs)"></Delete>
        <Delete Files="$(AutoGeneratedSwagger)"></Delete>
    </Target>

    <ItemGroup>
        <None Include="obj\$(Configuration)\net6.0\$(AutoGeneratedClientCs)" />
        <None Include="obj\$(Configuration)\net6.0\$(AutoGeneratedClientTs)" />
    </ItemGroup>

    <ItemGroup>
        <Content Include=".config\dotnet-tools.json" />
    </ItemGroup>

</Project>
