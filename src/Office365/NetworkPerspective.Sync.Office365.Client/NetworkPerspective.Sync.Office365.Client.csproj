<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFramework>net8.0</TargetFramework>
        <ServiceProjectDir>../NetworkPerspective.Sync.Office365</ServiceProjectDir>
        <CsProjPath>$(ServiceProjectDir)/NetworkPerspective.Sync.Office365.csproj</CsProjPath>
        <AutoGeneratedClientCs>Office365Client.cs</AutoGeneratedClientCs>
        <AutoGeneratedClientTs>Office365Client.ts</AutoGeneratedClientTs>
        <AutoGeneratedSwagger>openapi.json</AutoGeneratedSwagger>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
        <PackageReference Include="NSwag.MSBuild" Version="14.0.4">
            <PrivateAssets>all</PrivateAssets>
            <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
        </PackageReference>
        <PackageReference Include="System.ComponentModel.Annotations" Version="5.0.0" />
    </ItemGroup>

    <ItemGroup>
        <ProjectReference Include="$(CsProjPath)">
            <ReferenceOutputAssembly>False</ReferenceOutputAssembly>
        </ProjectReference>
    </ItemGroup>

    <Target Name="GenerateClients" BeforeTargets="CoreCompile">
        <Copy SourceFiles="$(ServiceProjectDir)/bin/$(Configuration)/net8.0/NetworkPerspective.Sync.Office365.xml" DestinationFiles="$(ServiceProjectDir)/bin/$(Configuration)/net8.0/dotnet-swagger.xml"></Copy>
        <Exec WorkingDirectory="$(ProjectDir)" Command="$(NSwagExe_Net80) run nswag.json /variables:input=$(CsProjPath),openApiJson=$(AutoGeneratedSwagger),outputCs=$(IntermediateOutputPath)$(AutoGeneratedClientCs),outputTs=$(IntermediateOutputPath)\$(AutoGeneratedClientTs)" ConsoleToMSBuild="true" />
        <ItemGroup>
            <Compile Include="$(IntermediateOutputPath)\$(AutoGeneratedClientCs)" />
        </ItemGroup>
    </Target>

    <Target Name="CleanUpClients" AfterTargets="CoreClean">
        <Delete Files="$(ServiceProjectDir)/bin/$(Configuration)/net8.0/dotnet-swagger.xml"></Delete>
        <Delete Files="$(IntermediateOutputPath)\$(AutoGeneratedClientCs)"></Delete>
        <Delete Files="$(IntermediateOutputPath)\$(AutoGeneratedClientTs)"></Delete>
        <Delete Files="$(AutoGeneratedSwagger)"></Delete>
    </Target>

    <ItemGroup>
        <None Include="obj\$(Configuration)\net8.0\$(AutoGeneratedClientCs)" />
        <None Include="obj\$(Configuration)\net8.0\$(AutoGeneratedClientTs)" />
    </ItemGroup>

</Project>
